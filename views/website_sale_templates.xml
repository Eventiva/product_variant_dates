<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Override the main product price to show calculated price for event tickets -->
    <template id="product_price_calculated" name="Product Price Calculated" inherit_id="website_sale.product_price">
        <xpath expr="//h3[@class='css_editable_mode_hidden']//span[@class='oe_price']" position="replace">
            <span class="oe_price" t-if="product.service_tracking == 'event' and product.event_ticket_id"
                  style="white-space: nowrap;"
                  t-out="combination_info.get('price', 0) + combination_info.get('price_extra', 0)"
                  t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"/>
            <!-- Fallback to original price for non-event products -->
            <span class="oe_price" t-else=""
                  style="white-space: nowrap;"
                  t-out="combination_info['price']"
                  t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"/>
        </xpath>
    </template>

    <!-- Override the badge_extra_price template to show calculated price instead of price adjustment (only for event tickets) -->
    <template id="badge_extra_price_calculated" name="Badge Calculated Price" inherit_id="website_sale.badge_extra_price">
        <xpath expr="//span[hasclass('badge', 'text-bg-info', 'border')]" position="replace">
            <span class="badge bg-primary text-white border-primary" t-if="product.service_tracking == 'event' and product.event_ticket_id">
                <!-- Show calculated final price instead of price adjustment for event tickets only -->
                <t t-set="base_price" t-value="combination_info.get('price', 0)"/>
                <t t-set="calculated_price" t-value="base_price + price_extra"/>
                <span t-out="calculated_price"
                    class="variant_calculated_price text-white fw-bold"
                    style="white-space: nowrap;"
                    t-options='{
                        "widget": "monetary",
                        "display_currency": (website.pricelist_id or product.env.company).currency_id
                    }'/>
            </span>
            <!-- Fallback to original badge for non-event products -->
            <span class="badge text-bg-info border" t-else="">
                <span class="sign_badge_price_extra" t-out="price_extra > 0 and '+' or '-'"/>
                <span t-out="abs(price_extra)"
                    class="variant_price_extra text-muted fst-italic"
                    style="white-space: nowrap;"
                    t-options='{
                        "widget": "monetary",
                        "display_currency": (website.pricelist_id or product.env.company).currency_id
                    }'/>
            </span>
        </xpath>
    </template>

</odoo>
